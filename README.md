# OrangeMapsPoint

Android приложение, которое отображает точки на карте Google Maps. Состоит из двух экранов:

1. Экран с двумя табами – карта и список.
На карте отображаются точки в радиусе от текущего местоположения.
В списке собираются все точки, которые были загружены в локальную базу данных.
1. Второй экран показывает инфомрацию о выбранной точке.

## Карта

Используется Google Maps из пакета Google Play Services. Для плоноценной работы рекомендуется
использовать собственный ключ для работы с API. На карте доступны кнопки для изменения масштаба и
определения текущего местоположения (если получено разрешение от пользователя).
Радиус поиска ограничен видимой частью карты, вычисляется как половина высоты карты.
Информация о выбранной точке выводится в Bottom Sheet внизу экрана.
Оттуда доступен переход на экран просмотра деталей точки.

## Список точек и информация

В вертикальном списке собираются все точки, которые были закешированы в локальной базе данных.
В элементе списка показана базовая информация о точке. Используется та же разметка, что у Bottom Sheet.
Оттуда доступен переход к экрану деталей.

Экран деталей точки содержит дополнительное поле – статус "просмотренности".
Открыв инорфмацию о точке повторно, будет показан инидкатор. Для улучшения пользовательского опыта
применяется shared element transition.

## Детали технической реализации

Доменная модель приложения состоит из двух сущностей – точка и партнер.
С партнером может быть ассоциировано множество точек.
Партнер имеет набор параметров, среди которых – ключ к иконке.
Поэтому в структуре базы данных описына два отношения Точки и Партнеры
и атрибут `DataPoint#partnerName` ограничен как внешний ключ к `Partner#id`.
Отношение DataPoint собержит дополнительный атрибут `viewed: Boolean`, который не передается с сервера,
а хранится исключительно локально. Отношение Partner полностью идентично телу сетевого запроса
получения партнеров, под него не выделяется отдельный объект.
Структура данных Point не содержит информацию об ассоциированном партнере.
Однако требуется выводить как минимум иконку партнера. Принятно решение кешировать
на определенной время список партнеров в отдельной таблице локальной базы данных.
Обновление партнеров выполняется до того, как будет сохранена какая-либо точка, иначе будет
нарушено ограничения базы данных на внешние ключи.

Для вывода списка точек с дополнительной информацией о их партнерах используется INNER JOIN запрос к
базе данных. Альтернативным решением может быть отдельная выборка содержимого отношения Партнеры
в оперативную память в виде хэш-таблицы и отложенное связывание каждой точки по ключу.
Указанные действия могут быть инкапсулированы в презенторе или интеракторе.

Приложение построено на подходе MVP и использует библиотеку Moxy.
Слой данных представляет класс `Repository` и два источника `Network` и `AppDatabase`.
Для выполнения сетевых запросов используется Retrofit, для взаимодействия с базой данных – Room.
Не реляционные данные сохраняется на диск посредством `SharedPrefs`.
Логика приложения предствлена в классах `CacheValidator`, `PermissionChecker`, `Radiator`.

Приложение содержит в себе два активити –
`MainActivity` с компонентом ViewPager для переключения вкладок и `PointActivity`.
Каждая вкладка представлена независимым фрагментом `MapsFragment` и `ListFragment`.
Фрагменты никак не взаимодействуют между собой.
Большая часть кода скоцентрирована в `MapsFragment` и направлена на формирование
нужного пользовательского опыта работы с картой.

Сетевой запрос получения иконки партнера построен с учетом плотности пикселей устройства.
Класс `DpiProvider` посредством `DensityWriter` и `DensitySaturation` формирует требуемое строковое
представление плотности пикселей устройства.